---
import { marked } from 'marked';
import { Icon } from 'astro-icon/components';

import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';

import ko from '../../data/resume/ko.json';
import en from '../../data/resume/en.json';

export async function getStaticPaths() {
  const locales = ['en', 'ko'];
  return locales.map(lang => ({ params: { lang } }));
}

marked.setOptions({
  breaks: true,
  gfm: true,
});

const { lang } = Astro.params;
const t = (lang === 'ko') ? ko : en;
---

<Layout>
  <Navbar />

  <main class="w-full max-w-5xl mx-auto px-6 sm:px-10 py-8">
    <div class="prose dark:prose-invert">
      <section class="mt-4 sm:mt-5 mb-16 sm:mb-20 not-prose">
        <div class="flex flex-col sm:flex-row sm:items-baseline gap-x-2.5 gap-y-1 sm:gap-y-0.5">
          <h1 class="text-4xl sm:text-5xl font-semibold tracking-tight m-0 leading-tight">{t.name.primary}</h1>
          <span class="text-xl sm:text-2xl font-medium m-0 text-stone-700 dark:text-stone-300">{t.name.secondary}</span>
        </div>
        <p class="print:hidden mt-3 text-base font-medium text-stone-500 leading-normal">{t.bio}</p>
        <p class="hidden print:flex mt-3 flex-wrap gap-x-3 text-base font-medium text-stone-500 leading-normal">
          <a href="https://linkedin.com/in/sangwon090" class="inline-flex items-center gap-x-1 font-medium"><Icon aria-hidden="true" class="w-4 h-4" name="fa7-brands:linkedin-in" /> in/sangwon090</a>
          <a href="mailto:me@sryu.dev" class="inline-flex items-center gap-x-1 font-medium"><Icon aria-hidden="true"class="w-4 h-4 translate-y-[1px]" name="lucide:mail" /> me@sryu.dev</a>
          <a href="mailto:sangwon@soongsil.ac.kr" class="inline-flex items-center gap-x-1 font-medium"><Icon aria-hidden="true"class="w-4 h-4 translate-y-[1px]" name="lucide:mail" /> sangwon@soongsil.ac.kr</a>
        </p>
      </section>

      <div class="not-prose flex flex-col gap-y-12">
        {t.sections.map((section) => (
          <section>
            <h2 class="text-2xl font-bold m-0 mb-4 pb-2 leading-none border-b border-stone-200 dark:border-stone-800">{section.name}</h2>
            
            <div class="flex flex-col gap-y-8">
              {section.items.map((item) => (
                <article class="group">
                  <div class="flex flex-col sm:flex-row items-baseline leading-none">
                    <h3 class="flex-1 min-w-0 text-lg font-semibold m-0 leading-tight text-stone-900 dark:text-stone-100 [&_a]:underline" set:html={marked.parseInline(item.name)}></h3>
                    <p class="flex-shrink-0 whitespace-nowrap text-sm sm:ml-auto mt-1 sm:m-0 leading-none text-stone-500 font-medium">{item.period}</p>
                  </div>

                  {item.description && (
                    <p class="mt-3 sm:mt-1.5 m-0 leading-tight text-base text-stone-600 dark:text-stone-400 [&_a]:underline" 
                       set:html={marked.parseInline(item.description)} />
                  )}

                  {item.contents && (
                    <ul class="list-disc mt-3 sm:mt-1.5 pl-5 text-stone-600 dark:text-stone-400">
                      {item.contents.map((content) => (
                        <li class="leading-relaxed m-0 p-0 [&_a]:underline" 
                            set:html={marked.parseInline(content)} />
                      ))}
                    </ul>
                  )}
                </article>
              ))}
            </div>
          </section>
        ))}
      </div>
    </div>
  </main>

  <Footer />
</Layout>